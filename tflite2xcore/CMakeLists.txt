CMAKE_MINIMUM_REQUIRED(VERSION 3.14)

# Get the tensorflow build base directory
EXECUTE_PROCESS(COMMAND bazel info output_base WORKING_DIRECTORY  "${PROJECT_SOURCE_DIR}/../../tensorflow" OUTPUT_VARIABLE BAZEL_OUTPUT_BASE)
STRING(STRIP "${BAZEL_OUTPUT_BASE}" BAZEL_OUTPUT_BASE)
MESSAGE("bazel info output_base: ${BAZEL_OUTPUT_BASE}")

SET (TENSORFLOW_SOURCE_DIR "${PROJECT_SOURCE_DIR}/../../tensorflow" CACHE PATH "Location of Tensorflow source files." )
SET (TENSORFLOW_GENFILES_DIR "${PROJECT_SOURCE_DIR}/../../tensorflow/bazel-genfiles" CACHE PATH "Location of Tensorflow generated files." )
SET (FLATBUFFERS_SOURCE_DIR "${BAZEL_OUTPUT_BASE}/flatbuffers/include" CACHE PATH "Location of flatbuffers files." )
SET (ANYOPTION_SOURCE_DIR "${PROJECT_SOURCE_DIR}/../../AnyOption" CACHE PATH "Location of AnyOption files." )

ADD_EXECUTABLE (tflite2xcore "")

FILE(GLOB_RECURSE tflite2xcore_SOURCES
  "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp"
  "${CMAKE_CURRENT_SOURCE_DIR}/src/*.h"
)

SET (tflite2xcore_INCLUDES_PRIVATE
  ${CMAKE_CURRENT_SOURCE_DIR}/src
)

TARGET_SOURCES(tflite2xcore
  PRIVATE "${ANYOPTION_SOURCE_DIR}/anyoption.cpp"
  PRIVATE ${tflite2xcore_SOURCES}
)

TARGET_INCLUDE_DIRECTORIES(tflite2xcore
  PRIVATE ${TENSORFLOW_GENFILES_DIR}
  PRIVATE ${TENSORFLOW_SOURCE_DIR}
  PRIVATE ${FLATBUFFERS_SOURCE_DIR}
  PRIVATE ${ANYOPTION_SOURCE_DIR}
  PRIVATE ${tflite2xcore_INCLUDES_PRIVATE}
)

INSTALL (TARGETS tflite2xcore DESTINATION bin)
